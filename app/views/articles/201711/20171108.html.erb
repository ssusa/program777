<%= render "/articles/article_header" %>

この記事は未完成です。

<br>
<h2 class="midashi01">①tasks_controller.rb編集</h2>

<span class="prettyprint-filename">/app/controllers/tasks_controller.rb</span>
<pre class="prettyprint linenums">
︙

#編集画面 表示のアクション
def edit

  #idでタスクテーブルを取得
  @task = Task.find(params[:id])

  #期限に値がある場合、日付型から文字列へ変換
  if @task.kigen.present?
    @task.kigen_str = @task.kigen.strftime("%Y%m%d")
  end

end

︙

#編集画面 更新ボタン押下時のアクション
def update

  #POSTされた値(id)からレコードを取得
  @task = Task.find(params[:id])

  #レコードをPOSTされた値(入力値)で上書き
  @task.assign_attributes(task_params)

  #エラーチェック
  if @task.valid?
    #--------------
    #エラーがない場合
    #--------------
    if @task.kigen_str.present?
      @task.kigen = Date.new(
        @task.kigen_str[0..3].to_i,
        @task.kigen_str[4..5].to_i,
        @task.kigen_str[6..7].to_i)
    end

    #更新（エラーチェックを行わない）
    @task.save(validate:false)

    #フラッシュ（一度きりのセッション）にメッセージを格納
    flash[:msg] = "編集しました。"

    #一覧画面へリダイレクト
    redirect_to tasks_path
  else
    #--------------
    #エラー時
    #--------------
    render "edit"
  end
end

︙
</pre>

<br>
<h2 class="midashi01">②edit.html.erb</h2>

<span class="prettyprint-filename">/app/views/tasks/new.html.erb</span>
<pre class="prettyprint linenums">
&lt;h2&gt;編集画面&lt;/h2&gt;
&lt;div class="waku"&gt;
  &lt;%= form_for @task do |f| %&gt;
      &lt;%= render "form", f: f %&gt;
      &lt;div class="row well" style="margin:20px 0 0 0;padding:10px;"&gt;
        &lt;div class="col-sm-12"&gt;
          &lt;%= link_to "キャンセル", tasks_path, class:"btn btn-default", style:"float:left;" %&gt;
          &lt;%= f.submit "編集する", class:"btn btn-primary", style:"float:right" %&gt;
        &lt;/div&gt;
      &lt;/div&gt;
  &lt;% end %&gt;
&lt;/div&gt;
</pre>

<%= render "/articles/article_footer" %>